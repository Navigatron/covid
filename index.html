<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="Covid-19 case counts by county. No silly circles.">
	<link rel="canonical" href="https://covidbycounty.com">

	<meta property="og:url"           content="https://covidbycounty.com" />
	<meta property="og:type"          content="website" />
	<meta property="og:title"         content="Covid-19 by County" />
	<meta property="og:description"   content="Covid-19 case counts by county" />
	<meta property="og:image"         content="https://covidbycounty.com/preview.png" />
	<meta name="twitter:card" content="summary_large_image">

	<title>Covid-19 by County</title>
	<script type="text/javascript" src="https://d3js.org/d3.v3.min.js"></script>
	<script type="text/javascript" src="https://d3js.org/queue.v1.min.js"></script>
	<script type="text/javascript" src="https://d3js.org/topojson.v1.min.js"></script>
	<link rel="stylesheet" href="./index.css">
</head>
<body>

<!-- Facebook share button support -->
<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v6.0"></script>

<!-- Twitter button support -->
<script>
	window.twttr = (
		function(d, s, id) {
			var js, fjs = d.getElementsByTagName(s)[0],
			t = window.twttr || {};
			if (d.getElementById(id)) return t;
			js = d.createElement(s);
			js.id = id;
			js.src = "https://platform.twitter.com/widgets.js";
			fjs.parentNode.insertBefore(js, fjs);
			t._e = [];
			t.ready = function(f) {
				t._e.push(f);
			};
			return t;
		}(document, "script", "twitter-wjs")
	);
</script>

<header>
	<h1>Covid-19 by County</h1>
</header>

<section class="map">
	<div id="map">
	</div>
</section>

<main>
	<h1>Covid-19 by County</h1>
	<p>
		Last update: 2020-03-24
	</p>
	<p>
		Data is from the department of health for each state. See the table below for more information.
	</p>
	<p>
		Black regions have no data (yet). Finding a source for a state takes some time. However, once that source is secured, updating is very quick.
	</p>

	<h2>Anomalies</h2>
	<p>
		Some states do not publish county-by-county statistics.
		In the future, the total case counts for these states may be divided among all counties.
		States with non-detailed data so far:
	</p>
	<ul>
		<li>California</li>
		<li>Rhode Island</li>
		<li>New Mexico</li>
	</ul>
	<h2>You can help</h2>
	<h4>Update the Map</h4>
	<p>
		There are over 3000 counties in the US - I cannot do this alone. Help keep this map updated by <a href="https://github.com/Navigatron/covid">submitting a pull request on github</a>.
	</p>
	<h4>Share the map</h4>
	<p>
		Help others learn more.
	</p>
	<div id="social">
		<div class="share-button">
			<a
				class="twitter-share-button"
				href="https://twitter.com/intent/tweet">
				Tweet
			</a>
		</div>
		<div class="share-button">
			<div class="fb-share-button" data-href="https://covidbycounty.com" data-layout="button_count" data-size="small"><a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fcovidbycounty.com%2F&amp;src=sdkpreparse" class="fb-xfbml-parse-ignore">Share</a></div>
		</div>
	</div>
	<h2>Data Source</h2>
	<p>
		Data is from John Hopkins daily reports.
	</p>
	<h2>Old Data Sources</h2>
	<p>
		Before switching to john hopkins data, we used the below sources.
	</p>
	<p>
		This table is updated when state data is updated or a new state is added.
	</p>
	<table>
		<tr>
			<th>State</th>
			<th>Data as of</th>
			<th>Source</th>
		</tr>
		<tr>
			<td>Colorado</td>
			<td>--03-22 4PM</td>
			<td> <a href="https://covid19.colorado.gov/data">covid19.colorado.gov</a> </td>
		</tr>
		<tr>
			<td>Connecticut</td>
			<td>--03-22 5PM</td>
			<td> <a href="https://portal.ct.gov/Coronavirus">portal.ct.gov/Coronavirus</a> </td>
		</tr>
		<tr>
			<td>Delaware</td>
			<td>--03-23 3PM</td>
			<td> <a href="https://dhss.delaware.gov/dhss/dph/epi/2019novelcoronavirus.html">dhss.delaware.gov</a> </td>
		</tr>
		<tr>
			<td>Florida</td>
			<td>--03-23 ???</td>
			<td> <a href="https://experience.arcgis.com/experience/96dd742462124fa0b38ddedb9b25e429">arcgis.com</a> </td>
		</tr>
		<tr>
			<td>Georgia</td>
			<td>--03-22 7PM</td>
			<td> <a href="https://dph.georgia.gov/covid-19-daily-status-report">dph.georgia.gov</a> </td>
		</tr>
		<tr>
			<td>Louisiana</td>
			<td>--03-20 10AM</td>
			<td> <a href="http://ldh.la.gov/Coronavirus/">ldh.la.gov/Coronavirus</a> </td>
		</tr>
		<tr>
			<td>Maine</td>
			<td>--03-22 Noon</td>
			<td> <a href="https://www.maine.gov/dhhs/mecdc/infectious-disease/epi/airborne/coronavirus.shtml">www.maine.gov/dhhs</a> </td>
		</tr>
		<tr>
			<td>Maryland</td>
			<td>--03-23 10AM</td>
			<td> <a href="https://coronavirus.maryland.gov">coronavirus.maryland.gov</a> </td>
		</tr>
		<tr>
			<td>Massachusetts</td>
			<td>--03-22 4PM</td>
			<td> <a href="https://www.mass.gov/info-details/covid-19-cases-quarantine-and-monitoring">Click the PDF</a> </td>
		</tr>
		<tr>
			<td>New Hampshire</td>
			<td>--03-22 9AM</td>
			<td> <a href="https://www.nh.gov/covid19/">www.nh.gov/covid19</a> </td>
		</tr>
		<tr>
			<td>New Jersey</td>
			<td>--03-22 2PM</td>
			<td> <a href="https://www.nj.gov/health/cd/topics/covid2019_dashboard.shtml">www.nj.gov/health</a> </td>
		</tr>
		<tr>
			<td>New York</td>
			<td>--03-22 2PM</td>
			<td>
				<a href="https://coronavirus.health.ny.gov/county-county-breakdown-positive-cases">
					NYS
				</a>,
				<a href="https://www1.nyc.gov/site/doh/covid/covid-19-main.page">
					NYC
				</a>
			</td>
		</tr>
		<tr>
			<td>North Carolina</td>
			<td>--03-23 8AM</td>
			<td> <a href="https://www.ncdhhs.gov/covid-19-case-count-nc">www.ncdhhs.gov</a> </td>
		</tr>
		<tr>
			<td>Oregon</td>
			<td>--03-22 8AM</td>
			<td> <a href="https://www.oregon.gov/oha/PH/DISEASESCONDITIONS/DISEASESAZ/Pages/emerging-respiratory-infections.aspx">oregon.gov (Click "Demographic")</a> </td>
		</tr>
		<tr>
			<td>Pennsylvania</td>
			<td>--03-23 Noon</td>
			<td><a href="https://www.health.pa.gov/topics/disease/Pages/Coronavirus.aspx">www.health.pa.gov</a></td>
		</tr>
		<tr>
			<td>South Carolina</td>
			<td>--03-22 4PM</td>
			<td><a href="https://www.scdhec.gov/infectious-diseases/viruses/coronavirus-disease-2019-covid-19/monitoring-testing-covid-19">www.scdhec.gov</a></td>
		</tr>
		<tr>
			<td>Texas</td>
			<td>--03-23 1PM</td>
			<td> <a href="https://www.dshs.texas.gov/news/updates.shtm#coronavirus">dshs.texas.gov</a> </td>
		</tr>
		<tr>
			<td>Vermont</td>
			<td>--03-22 2PM</td>
			<td> <a href="https://www.healthvermont.gov/response/infectious-disease/2019-novel-coronavirus">healthvermont.gov</a> </td>
		</tr>
		<tr>
			<td>Virginia</td>
			<td>--03-22 noon</td>
			<td> <a href="http://www.vdh.virginia.gov/coronavirus/">vdh.virginia.gov</a> </td>
		</tr>
		<tr>
			<td>Washington</td>
			<td>--03-22 3PM</td>
			<td> <a href="https://www.doh.wa.gov/Emergencies/Coronavirus">www.doh.wa.gov</a> </td>
		</tr>
	</table>
</main>
<footer>
&copy; 2020 <a href="https://ewitherington.me">Ethan Witherington</a> and <a href="https://github.com/Navigatron/covid/graphs/contributors">contributors</a>
</footer>

<script type="text/javascript">
	// Variables
	var width = 960, height = 600;
	var color_domain = [1,2,11,101, 1001, 10001]; // This is post the +1 to account for log scale
	var ext_color_domain = [0,1,2,5,10,20,50,100,200,500, 1000,2000,5000,10000]
	var legend_labels = ["0","1","2","5","10","20","50","100","200","500","1000","2000","5000","10000"]

	// Color? Yessss this is fun to play with
	//var color = d3.scale.threshold()
	var color = d3.scale.log()
		.domain(color_domain)
		//.domain([1,2,20,400]) // max NYC 329
		//.range(["#dcdcdc", "#d0d6cd", "#bdc9be", "#aabdaf", "#97b0a0", "#84a491", "#719782", "#5e8b73", "#4b7e64", "#387255", "#256546", "#125937", "#004d28"]);
		.range([
			"#00FF00", // nobody = green
			"#FFFF00", //    1 = yellow
			"#FF0000", //   10 = red
			"#ff00ff", //  100 = purple
			"#0000FF",  // 1000 = blue
			"#00FFFF"  // 10000 = cyan
			]);

	// Creates the tooltop, transparent.
	var div = d3.select("body").append("div")
		.attr("class", "tooltip")
		.style("opacity", 0);

	// Create the svg, set some attributes
	var svg = d3.select("#map").append("svg")
		.attr("width", width)
		//.attr("max-width", "100%")
		.attr("viewBox", "0 0 "+width+" "+height)
		.attr("height", height)
		.style("max-width", "100%")
		.style("height", "100%")
		.style("margin", "0px auto");
		// .call(d3.behavior.zoom().on("zoom", function () {
		// 	svg.attr("transform", "translate(" + d3.event.translate + ")" + " scale(" + d3.event.scale + ")")
		// }));

	// It looks like this does the actual stuff.
	// Load all that data and then call the ready function
	var path = d3.geo.path();

	// What does this do?
	// looks like it just sets things to load, then call the function when the data is here
	queue()
		.defer(d3.json, "us.json")
		.defer(d3.csv, "03-24-2020.csv")
		.await(ready);

	function ready(error, us, data) {
		// Aight here's what we got:
		// - div: the tooltip
		// - color: a function to turn a number to a color
		// - svg: The svg element on the page
		// - path: A geo-pathy thing? function, data -> path
		// - us: the united states geo-json
		// - data: the csv of case counts

		// Mappings of IDs to data about the IDs.
		var pairRateWithId = {};
		var pairNameWithId = {};

		// Moves selction to front
		d3.selection.prototype.moveToFront = function() {
			return this.each(
				function(){
					this.parentNode.appendChild(this);
				}
			);
		};

		// Moves selction to back
		d3.selection.prototype.moveToBack = function() {
			return this.each(function() {
				var firstChild = this.parentNode.firstChild;
				if (firstChild) {
					this.parentNode.insertBefore(this, firstChild);
				}
			});
		};

		// Kinda turn that csv into json
		data.forEach(function(d) {
			pairRateWithId[d.FIPS] = +d.Confirmed;
			// IDs are given a rate variable
			pairNameWithId[d.FIPS] = d.Admin2;
			// IDs are given a *name* variable
			//console.log('Processing ', d);
		});

		//console.log(pairRateWithId);

		// Append a 'g' element to the svg (a group!)
		svg.append("g")
			// We are now operating on the group
			// Set an attribute - this group has counties
			.attr("class", "county")
			// This is where the zoom should be, because we only want to zoom this part
			// Move from the group to 'paths' within the group - that may or may not exist
			.selectAll("path")
			// This applies the US data to the selection
			.data(topojson.feature(us, us.objects.counties).features)
			// ENTER kinda selects the elements that are being added
			// Things that are going in that aren't in yet
			.enter()
			// Append a path item to the group
			.append("path")
			// Set the actual path data of this path, via our path function
			.attr("d", path)
			// Set the fill style of the path (county)
			.style ( "fill" , function (d) {
				//console.log(d);
				return color (pairRateWithId[d.id]+1); // convert the ID's rate to a color. Color is a function that takes a number and returns a color
				// Plus 1 is in there to counter the log limitation of all values positive
			})
			// set some more style things
			.style({'opacity': 1, 'stroke': 'black', 'stroke-width': 0.1})
			// Do this when we hover over a county
			.on("mouseover", function(d) { // This creates the hover dialog // commented to make faster
				var sel = d3.select(this);
				sel.moveToFront();

				d3.select(this).transition().duration(300).style({'stroke': 'black', 'stroke-width': 1});

				div.transition().duration(300)
				.style("opacity", 1);

				// show the tooltip
				div.text(d.id + ": " + pairNameWithId[d.id] + ": " + pairRateWithId[d.id])
				.style("left", (d3.event.pageX+10) + "px")
				.style("top", (d3.event.pageY -30) + "px");
			})
			// un-hover
			.on("mouseout", function() {

				// move 'this' to the back
				var sel = d3.select(this);
				sel.moveToBack();

				// Fade the county back in/out?
				d3.select(this)
					.transition()
					.duration(300)
					.style({'opacity': 1, 'stroke': 'black', 'stroke-width': 0.1});

				// Make the tooltip transparent
				div.transition()
					.duration(300)
					.style("opacity", 0);
			})


		// Append a 'g' element to the svg (a group!)
		svg.append("g")
			// We are now operating on the group
			// Set an attribute - this group has states
			.attr("class", "state")
			// Move from the group to 'paths' within the group - that may or may not exist
			.selectAll("path")
			// This applies the US data to the selection
			.data(topojson.feature(us, us.objects.states).features)
			// ENTER kinda selects the elements that are being added
			// Things that are going in that aren't in yet
			.enter()
			// Append a path item to the group
			.append("path")
			// Set the actual path data of this path, via our path function
			.attr("d", path)
			// set some more style things
			.style({'opacity': 1, 'fill': 'cyan', 'fill-opacity': 0, 'stroke': 'black', 'stroke-width': 0.5, 'pointer-events': 'none'})

	};

	// The Legend
	var legend = svg.selectAll("g.legend")
		.data(ext_color_domain)
		.enter().append("g")
		.attr("class", "legend");

	// Evil Magic Numbers What do they MEAN
	// Legend Sample Width and Legend Sample Height
	var ls_w = width/legend_labels.length;
	var ls_h = 20;

	// Legend Rectangles
	legend.append("rect")
		//.attr("x", function(d, i){ return width - (i*ls_w) - ls_w;})
		.attr("x", function(d, i){ return (i*ls_w);})
		.attr("y", 550)
		.attr("width", ls_w)
		.attr("height", ls_h)
		.style("fill", function(d, i) { return color(d+1); })
		.style("opacity", 0.8);

	// Legend Text
	legend.append("text")
		//.attr("x", function(d, i){ return width - (i*ls_w) - ls_w;})
		.attr("x", function(d, i){ return (i*ls_w);})
		.attr("y", 590)
		.text(function(d, i){ return legend_labels[i]; });

	// Leged Title? Coolio.
	var legend_title = "Covid19 Cases";

	// Slap the text onto the legend
	svg.append("text")
		.attr("x", 10)
		.attr("y", 540)
		.attr("class", "legend_title")
		.text(function(){return legend_title});

</script>
</body>

</html>
